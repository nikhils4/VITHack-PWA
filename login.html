<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<title>Login</title>
	<style>
		#loadp,
		#qrcodep {
			display: none
		}
	</style>
</head>

<body>


	<div class="container-fluid" id="loginp">
		<div class="row" style="text-align: center">
			<div class="col-12" style="font-size: 20px; font-weight : bolder; margin-top : 20px">
				<img src="./icons/left-arrow.jpg" style="height : 25px; float : left" id="back">
				Login
			</div>


			<div class="col-12" style="margin-top : 70px">
				<img class="img-responsive" src="./icons/logo.jpg" style="width : 200px; margin : auto auto">
			</div>
			<div class="col-2"></div>
			<div class="col-8" id="error"
				style="margin-right : 50px;padding : 10px; border : 1px solid red; border-radius : 10px; font-size : 15px; display: none ">
			</div>
			<div class="col-2"></div>
			<div class="col-12" style="margin-top : 50px">
				<input type="text" placeholder="Code" id="code"
					style="padding : 8px 10px; border : 1px solid lightgray; border-radius : 5px;">
			</div>

			<div class="col-12" style="margin-top : 60px">
				<button class="btn btn-primary" id="login"
					style="background-color: #007bff;box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); padding-right : 50px; padding-left : 50px; padding-top : 10px ;padding-bottom : 10px; border-radius : 10px">Login</button>
			</div>

		</div>
	</div>


	<div class="container-fluid" id="loadp">
		<div class="row" style="text-align: center; margin-top : 250px">
			<div class="col-12" style="font-size: 20px; font-weight : bolder; margin-top : 20px">
				<img src="./icons/load.gif" style="height : 50px;">
			</div>
			<div class="col-12" style="font-size: 20px; font-weight : bolder; margin-top : 20px; color: #0186f4">
				Loading...
			</div>
		</div>
	</div>





	<div class="container-fluid" id="qrcodep">
		<div class="row">

			<div class="col-12" style="margin-top : 20px; font-size : 25px; font-weight : bolder">
				QR code
			</div>

			<div class="col-4"></div>

			<div class="col-4" id="team" style="text-align: center; margin-top : 50px">

				<select class="form-control"></select>

			</div>

			<div class="col-4"></div>


			<div class="col-12" style="margin-top : 50px; text-align : center">
				<img src="./icons/qr.png" style="height: 150px" id="qr-img">
			</div>

			<div class="col-12" style="text-align: center; margin-top : 80px">
				<p><span style="font-weight : bolder">Email : </span><span id="email"></span></p>
				<p><span style="font-weight : bolder">Team ID : </span><span id="teamid"></span></p>
			</div>
		</div>

		<div class="row"
			style="position: fixed; bottom : 0; width : 100%; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); background-color: white">
			<div class="col-3" style="text-align: center; position: relative; padding : 20px">
				<a href="./home.html" style="text-decoration: none"><img src="./icons/home.jpg"
						style="height: 25px; margin : auto auto"></a>
			</div>
			<div class="col-3" style="text-align: center;; padding : 20px">
				<a href="./about.html" style="text-decoration: none"><img src="./icons/info.jpg"
						style="height: 25px; margin: auto auto"></a>
			</div>
			<div class="col-3" style="text-align: center; padding : 20px">
				<a href="./qrcode.html" style="text-decoration: none"><img src="./icons/focusblue.jpg"
						style="height: 25px; margin : auto auto"></a>
			</div>
			<div class="col-3" style="text-align: center; padding : 20px">
				<a href="./contact-us.html" style="text-decoration: none"><img src="./icons/call.jpg"
						style="height: 25px; margin : auto auto"></a>
			</div>

		</div>

	</div>
	</div>



	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>

	<script>

		window.onload = () => {






			document.getElementById("login").addEventListener("click", () => {
				document.getElementById("loginp").style.display = "none";
				document.getElementById("loadp").style.display = "block";
				var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
				xmlhttp.open("POST", "https://vithack.herokuapp.com/mobile/auth/login");
				xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
				xmlhttp.send(JSON.stringify({ "passcode": document.getElementById("code").value }));
				xmlhttp.onreadystatechange = function () {
					if (xmlhttp.readyState == 4) {
						if (JSON.parse(xmlhttp.responseText).err == "Not found") {
							document.getElementById("loginp").style.display = "block";
							document.getElementById("loadp").style.display = "none";
							document.getElementById("error").style.display = "block"
							document.getElementById("error").innerHTML = "Please enter valid code"
						} else if (JSON.parse(xmlhttp.responseText).err == "Max team login size reached") {
							document.getElementById("loginp").style.display = "block";
							document.getElementById("loadp").style.display = "none";
							document.getElementById("error").style.display = "block"
							document.getElementById("error").innerHTML = "Max team login size reached"
						}
						else {

							let team = JSON.parse(xmlhttp.responseText).teamMates;
							let m = document.createElement("option");
								let text = document.createTextNode(JSON.parse(xmlhttp.responseText).email);
								m.appendChild(text);
								document.getElementsByClassName("form-control")[0].appendChild(m);
							for (i = 0; i < team.length; i++) {
								let m = document.createElement("option");
								let text = document.createTextNode(team[i]);
								m.appendChild(text);
								document.getElementsByClassName("form-control")[0].appendChild(m);
							}

							document.getElementById("qrcodep").style.display = "block";
							document.getElementById("loadp").style.display = "none";
							document.getElementById("qr-img").setAttribute("src", `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${JSON.parse(xmlhttp.responseText).email}`);
							document.getElementById("email").innerHTML = JSON.parse(xmlhttp.responseText).email;
							document.getElementById("teamid").innerHTML = document.getElementById("code").value;
						}
					}
				};
			})
			document.getElementById("back").addEventListener("click", () => {
				window.location.href = "qrcode.html"
			})

			function listQ() {
				document.getElementById("qr-img").setAttribute("src", `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${document.getElementsByClassName("form-control")[0].value}`);
			}
			document.getElementById("team").onchange = listQ;
		}

	</script>


</body>

</html>